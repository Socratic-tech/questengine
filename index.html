<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aethelgard: Fate of the Kingdom</title>
    <style>
        body { background: #0c0c0c; color: #55FF55; font-family: 'Courier New', monospace; display: flex; justify-content: center; margin: 0; overflow: hidden; }
        #game-container { width: 90%; max-width: 900px; padding: 20px; position: relative; }
        #display { height: 500px; overflow-y: auto; border: 2px solid #444; padding: 20px; background: #000; line-height: 1.6; }
        #input-area { display: flex; align-items: center; padding: 15px 0; border-top: 1px solid #333; }
        #cmd-input { background: transparent; border: none; color: #FFFF55; font-family: inherit; font-size: 1.2rem; width: 100%; outline: none; margin-left: 10px; }
        
        /* Intro Screen Overlay */
        #intro-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border: 2px solid #55FF55; }
        .start-btn { background: #55FF55; color: #000; border: none; padding: 15px 30px; font-family: inherit; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .start-btn:hover { background: #FFFF55; }
        
        .room-title { color: #FF55FF; font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #444; display: block; margin-bottom: 10px; }
        .user-cmd { color: #FFFF55; margin: 10px 0; font-weight: bold; }
        .ending-card { padding: 20px; border: 4px double #55FFFF; text-align: center; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="intro-screen">
        <h1 style="color: #FF55FF;">THE AETHELGARD SAGA</h1>
        <p style="max-width: 600px;">Welcome, Adventurer. Your choices shape the realm.</p>
        <div style="text-align: left; background: #111; padding: 20px; border: 1px solid #333;">
            <strong>HOW TO INTERACT:</strong><br>
            • <b>GO [Direction]</b> - Move between areas (North, South, East, West)<br>
            • <b>TAKE [Item]</b> - Pick up an object<br>
            • <b>USE [Item]</b> - Use an item on your current surroundings<br>
            • <b>INV</b> - View your inventory<br>
            • <b>LOOK</b> - Re-describe the current room
        </div>
        <button class="start-btn" onclick="startGame()">BEGIN YOUR QUEST</button>
    </div>

    <div id="display"></div>
    <div id="input-area"><span>></span><input type="text" id="cmd-input" autocomplete="off"></div>
</div>

<script>
/** 1. GAME STATE & MORAL TRACKER **/
let state = {
    current: "village_square",
    inv: [],
    flags: { fed_beggar: false, stole_gold: false, killed_guardian: false },
    alignment: 0, // Positive = Merciful, Negative = Ruthless
    gameStarted: false
};

/** 2. THE BRANCHING WORLD DATA **/
const world = {
    "village_square": {
        title: "Oakhaven Square",
        desc: () => "A starving beggar asks for a coin. To the NORTH is the path to the Castle. To the WEST is the Treasury.",
        exits: { north: "castle_gates", west: "treasury" },
        items: ["bread"],
        interactions: {
            "bread": { msg: "You give the bread to the beggar. He blesses you.", align: 5, flag: "fed_beggar" }
        }
    },
    "treasury": {
        title: "The Old Treasury",
        desc: () => "A chest sits here. You could TAKE GOLD, but it belongs to the village. Exit EAST.",
        exits: { east: "village_square" },
        items: ["gold"],
        onTake: (item) => { if(item === 'gold') { state.alignment -= 10; state.flags.stole_gold = true; } }
    },
    "castle_gates": {
        title: "Castle Gates",
        desc: () => "A mystical Guardian blocks the way NORTH. You can USE GOLD to bribe him, or USE BREAD to show mercy.",
        exits: { north: "throne_room", south: "village_square" },
        condition: (d) => (d === "north" && !state.flags.passed_gate) ? "The Guardian stands firm." : null,
        interactions: {
            "gold": { msg: "You bribe the Guardian. He sneers but lets you pass.", align: -5, flag: "passed_gate" },
            "bread": { msg: "You share your food. The Guardian bows and steps aside.", align: 10, flag: "passed_gate" }
        }
    },
    "throne_room": {
        title: "The Throne Room",
        desc: () => "The King awaits. Your journey is judged.",
        exits: {},
        isEnding: true
    }
};

/** 3. ENGINE LOGIC **/
const display = document.getElementById('display');
const inputField = document.getElementById('cmd-input');

function startGame() {
    document.getElementById('intro-screen').style.display = 'none';
    state.gameStarted = true;
    render();
    inputField.focus();
}

function print(text, cls = "") {
    const p = document.createElement('p');
    if (cls) p.className = cls;
    p.innerHTML = text;
    display.appendChild(p);
    display.scrollTop = display.scrollHeight;
}

function render() {
    const room = world[state.current];
    if (room.isEnding) { renderEnding(); return; }
    
    display.innerHTML = "";
    print(`<span class="room-title">${room.title}</span>`);
    print(room.desc());
    if (room.items?.length) print(`<span style="color: #55FFFF">You see: ${room.items.join(", ")}</span>`);
}

function renderEnding() {
    display.innerHTML = "";
    let endingTitle = "";
    let endingDesc = "";

    if (state.alignment >= 10) {
        endingTitle = "THE BENEVOLENT HERO";
        endingDesc = "You took the path of mercy. Aethelgard prospers under your kindness.";
    } else if (state.alignment <= -10) {
        endingTitle = "THE RUTHLESS TYRANT";
        endingDesc = "You took what you wanted. You rule with an iron fist, but you are alone.";
    } else {
        endingTitle = "THE UNKNOWN WANDERER";
        endingDesc = "You finished your quest, but the songs won't remember your name.";
    }

    print(`<div class="ending-card"><h1 style="color: #FFFF55">${endingTitle}</h1><p>${endingDesc}</p><button class="start-btn" onclick="location.reload()">PLAY AGAIN</button></div>`);
}

function handle(input) {
    const p = input.toLowerCase().trim().split(" ");
    const verb = p[0], noun = p[p.length - 1], room = world[state.current];
    print(`> ${input}`, "user-cmd");

    if (verb === "go" || Object.keys(room.exits).includes(verb)) {
        const dir = Object.keys(room.exits).includes(verb) ? verb : noun;
        if (room.exits[dir]) {
            const err = room.condition ? room.condition(dir) : null;
            if (err) print(err);
            else { state.current = room.exits[dir]; render(); }
        } else print("You can't go that way.");
    } else if (verb === "take") {
        if (room.items?.includes(noun)) {
            state.inv.push(noun);
            room.items = room.items.filter(i => i !== noun);
            if (room.onTake) room.onTake(noun);
            print(`Picked up: ${noun}`);
        } else print("Nothing to take.");
    } else if (verb === "use") {
        if (state.inv.includes(noun) && room.interactions?.[noun]) {
            const act = room.interactions[noun];
            if (act.flag) state.flags[act.flag] = true;
            if (act.align) state.alignment += act.align;
            print(act.msg);
            render();
        } else print("That doesn't seem to work here.");
    } else if (verb === "inv") {
        print("Inventory: " + (state.inv.join(", ") || "Empty"));
    } else if (verb === "look") {
        render();
    }
}

inputField.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && state.gameStarted) {
        handle(inputField.value);
        inputField.value = '';
    }
});
</script>
</body>
</html>
